{% extends "base.html" %}

{% block title %}Dashboard - NEXDB{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- MySQL Databases -->
    <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow border border-gray-200 dark:border-gray-700 flex flex-col">
      <div class="flex items-center mb-3">
        <div class="w-10 h-10 flex items-center justify-center bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-500 rounded-lg mr-3">
          <i class="fas fa-database"></i>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">MySQL Databases</span>
      </div>
      <div class="mt-auto">
        <div class="text-3xl font-bold text-gray-900 dark:text-gray-100">{{ mysql_dbs|length }}</div>
        <a href="{{ url_for('database.index') }}" class="text-sm text-primary-600 dark:text-primary-500 hover:underline">View all</a>
      </div>
    </div>
    
    <!-- PostgreSQL Databases -->
    <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow border border-gray-200 dark:border-gray-700 flex flex-col">
      <div class="flex items-center mb-3">
        <div class="w-10 h-10 flex items-center justify-center bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-500 rounded-lg mr-3">
          <i class="fas fa-server"></i>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">PostgreSQL Databases</span>
      </div>
      <div class="mt-auto">
        <div class="text-3xl font-bold text-gray-900 dark:text-gray-100">{{ postgres_dbs|length }}</div>
        <a href="{{ url_for('database.index') }}" class="text-sm text-primary-600 dark:text-primary-500 hover:underline">View all</a>
      </div>
    </div>
    
    <!-- Projects -->
    <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow border border-gray-200 dark:border-gray-700 flex flex-col">
      <div class="flex items-center mb-3">
        <div class="w-10 h-10 flex items-center justify-center bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-500 rounded-lg mr-3">
          <i class="fas fa-project-diagram"></i>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Projects</span>
      </div>
      <div class="mt-auto">
        <div class="text-3xl font-bold text-gray-900 dark:text-gray-100">0</div>
        <a href="#" class="text-sm text-primary-600 dark:text-primary-500 hover:underline">View all</a>
      </div>
    </div>
    
    <!-- Backups -->
    <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow border border-gray-200 dark:border-gray-700 flex flex-col">
      <div class="flex items-center mb-3">
        <div class="w-10 h-10 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-500 rounded-lg mr-3">
          <i class="fas fa-save"></i>
        </div>
        <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Backups</span>
      </div>
      <div class="mt-auto">
        <div class="text-3xl font-bold text-gray-900 dark:text-gray-100">{{ recent_backups|length }}</div>
        <a href="{{ url_for('backup.index') }}" class="text-sm text-primary-600 dark:text-primary-500 hover:underline">View all</a>
      </div>
    </div>
  </div>
  
  <!-- Quick Actions -->
  <div class="bg-white dark:bg-gray-800 p-5 rounded-lg shadow border border-gray-200 dark:border-gray-700">
    <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100 mb-4">Quick Actions</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <a href="#" class="group flex items-center p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/10">
        <div class="w-10 h-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-500 rounded-lg mr-3 group-hover:bg-primary-200 dark:group-hover:bg-primary-900/50">
          <i class="fas fa-plus"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 dark:text-gray-100">New Project</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Create a new project</p>
        </div>
      </a>
      
      <a href="{{ url_for('database.create_database') }}" class="group flex items-center p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/10">
        <div class="w-10 h-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-500 rounded-lg mr-3 group-hover:bg-primary-200 dark:group-hover:bg-primary-900/50">
          <i class="fas fa-database"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 dark:text-gray-100">New Database</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Create a new database</p>
        </div>
      </a>
      
      <a href="{{ url_for('backup.create_backup') }}" class="group flex items-center p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/10">
        <div class="w-10 h-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-500 rounded-lg mr-3 group-hover:bg-primary-200 dark:group-hover:bg-primary-900/50">
          <i class="fas fa-save"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 dark:text-gray-100">Create Backup</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Backup your database</p>
        </div>
      </a>
      
      <a href="{{ url_for('backup.schedule_backup') }}" class="group flex items-center p-3 rounded-lg border border-dashed border-gray-300 dark:border-gray-700 hover:border-primary-500 dark:hover:border-primary-500 hover:bg-primary-50 dark:hover:bg-primary-900/10">
        <div class="w-10 h-10 flex items-center justify-center bg-primary-100 dark:bg-primary-900/30 text-primary-600 dark:text-primary-500 rounded-lg mr-3 group-hover:bg-primary-200 dark:group-hover:bg-primary-900/50">
          <i class="fas fa-calendar"></i>
        </div>
        <div>
          <h3 class="font-medium text-gray-900 dark:text-gray-100">Schedule Backup</h3>
          <p class="text-sm text-gray-500 dark:text-gray-400">Set up automatic backups</p>
        </div>
      </a>
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Databases List -->
    <div class="lg:col-span-2 space-y-6">
      <!-- MySQL Databases -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
            <i class="fab fa-mysql text-blue-600 dark:text-blue-500 mr-2"></i>
            MySQL Databases
          </h2>
          <a href="{{ url_for('database.create_database') }}" class="text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">+ New Database</a>
        </div>
        
        {% if mysql_dbs %}
          <div class="divide-y divide-gray-200 dark:divide-gray-700">
            {% for db in mysql_dbs %}
              <div class="p-4 flex flex-wrap items-center justify-between">
                <div class="flex items-center mb-2 sm:mb-0 mr-4">
                  <i class="fas fa-database text-blue-600 dark:text-blue-500 mr-3"></i>
                  <div>
                    <h3 class="font-medium text-gray-900 dark:text-gray-100">{{ db }}</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">MySQL</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button class="px-2 py-1 text-xs bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-700 dark:text-red-500 rounded">
                    <i class="fas fa-stop mr-1"></i> Stop
                  </button>
                  <button class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded">
                    <i class="fas fa-trash-alt mr-1"></i> Destroy
                  </button>
                  <a href="{{ url_for('backup.create_backup') }}?db_type=mysql&db_name={{ db }}" class="px-2 py-1 text-xs bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/30 text-green-700 dark:text-green-500 rounded">
                    <i class="fas fa-save mr-1"></i> Backup
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="p-8 text-center text-gray-500 dark:text-gray-400">
            <i class="fas fa-database text-gray-300 dark:text-gray-600 text-5xl mb-3"></i>
            <p>No MySQL databases found.</p>
            <a href="{{ url_for('database.create_database') }}" class="mt-3 inline-block text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">Create your first MySQL database</a>
          </div>
        {% endif %}
      </div>
      
      <!-- PostgreSQL Databases -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="border-b border-gray-200 dark:border-gray-700 p-4 flex justify-between items-center">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">
            <i class="fas fa-elephant text-green-600 dark:text-green-500 mr-2"></i>
            PostgreSQL Databases
          </h2>
          <a href="{{ url_for('database.create_database') }}" class="text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">+ New Database</a>
        </div>
        
        {% if postgres_dbs %}
          <div class="divide-y divide-gray-200 dark:divide-gray-700">
            {% for db in postgres_dbs %}
              <div class="p-4 flex flex-wrap items-center justify-between">
                <div class="flex items-center mb-2 sm:mb-0 mr-4">
                  <i class="fas fa-database text-green-600 dark:text-green-500 mr-3"></i>
                  <div>
                    <h3 class="font-medium text-gray-900 dark:text-gray-100">{{ db }}</h3>
                    <p class="text-xs text-gray-500 dark:text-gray-400">PostgreSQL</p>
                  </div>
                </div>
                <div class="flex space-x-2">
                  <button class="px-2 py-1 text-xs bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-700 dark:text-red-500 rounded">
                    <i class="fas fa-stop mr-1"></i> Stop
                  </button>
                  <button class="px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded">
                    <i class="fas fa-trash-alt mr-1"></i> Destroy
                  </button>
                  <a href="{{ url_for('backup.create_backup') }}?db_type=postgres&db_name={{ db }}" class="px-2 py-1 text-xs bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/30 text-green-700 dark:text-green-500 rounded">
                    <i class="fas fa-save mr-1"></i> Backup
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="p-8 text-center text-gray-500 dark:text-gray-400">
            <i class="fas fa-database text-gray-300 dark:text-gray-600 text-5xl mb-3"></i>
            <p>No PostgreSQL databases found.</p>
            <a href="{{ url_for('database.create_database') }}" class="mt-3 inline-block text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">Create your first PostgreSQL database</a>
          </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="space-y-6">
      <!-- Recent Backups -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Recent Backups</h2>
        </div>
        
        {% if recent_backups %}
          <div class="divide-y divide-gray-200 dark:divide-gray-700">
            {% for backup in recent_backups %}
              <div class="p-4">
                <div class="flex items-center mb-1">
                  <i class="fas {% if backup.db_type == 'mysql' %}fa-mysql text-blue-600 dark:text-blue-500{% else %}fa-database text-green-600 dark:text-green-500{% endif %} mr-2"></i>
                  <h3 class="font-medium text-gray-900 dark:text-gray-100">{{ backup.db_name }}</h3>
                </div>
                <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-2">
                  <span>{{ backup.db_type }}</span>
                  <span>{{ backup.created_at }}</span>
                </div>
                <div class="flex space-x-2">
                  <a href="{{ url_for('backup.download_backup', backup_id=backup.id) }}" class="px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/30 text-blue-700 dark:text-blue-500 rounded">
                    <i class="fas fa-download mr-1"></i> Download
                  </a>
                  <a href="{{ url_for('backup.delete_backup', backup_id=backup.id) }}" class="px-2 py-1 text-xs bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/30 text-red-700 dark:text-red-500 rounded">
                    <i class="fas fa-trash-alt mr-1"></i> Delete
                  </a>
                </div>
              </div>
            {% endfor %}
          </div>
          <div class="p-4 border-t border-gray-200 dark:border-gray-700">
            <a href="{{ url_for('backup.index') }}" class="text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">View all backups</a>
          </div>
        {% else %}
          <div class="p-8 text-center text-gray-500 dark:text-gray-400">
            <i class="fas fa-save text-gray-300 dark:text-gray-600 text-5xl mb-3"></i>
            <p>No backups found.</p>
            <a href="{{ url_for('backup.create_backup') }}" class="mt-3 inline-block text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">Create your first backup</a>
          </div>
        {% endif %}
      </div>
      
      <!-- Database Logs -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="p-4 border-b border-gray-200 dark:border-gray-700">
          <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100">Recent Database Logs</h2>
        </div>
        
        <div class="divide-y divide-gray-200 dark:divide-gray-700">
          <!-- Sample logs - Would be replaced with actual logs -->
          <div class="p-3 text-sm flex">
            <span class="text-xs text-gray-500 dark:text-gray-400 inline-block w-20">1 min ago</span>
            <div class="flex-1">
              <span class="px-1.5 py-0.5 text-xs bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-500 rounded">INFO</span>
              <span class="ml-2 text-gray-700 dark:text-gray-300">Database connection successful</span>
            </div>
          </div>
          <div class="p-3 text-sm flex">
            <span class="text-xs text-gray-500 dark:text-gray-400 inline-block w-20">5 mins ago</span>
            <div class="flex-1">
              <span class="px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-500 rounded">NOTICE</span>
              <span class="ml-2 text-gray-700 dark:text-gray-300">Backup completed successfully</span>
            </div>
          </div>
          <div class="p-3 text-sm flex">
            <span class="text-xs text-gray-500 dark:text-gray-400 inline-block w-20">10 mins ago</span>
            <div class="flex-1">
              <span class="px-1.5 py-0.5 text-xs bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-500 rounded">WARNING</span>
              <span class="ml-2 text-gray-700 dark:text-gray-300">Slow query detected</span>
            </div>
          </div>
          <div class="p-3 text-sm flex">
            <span class="text-xs text-gray-500 dark:text-gray-400 inline-block w-20">25 mins ago</span>
            <div class="flex-1">
              <span class="px-1.5 py-0.5 text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-500 rounded">NOTICE</span>
              <span class="ml-2 text-gray-700 dark:text-gray-300">User 'admin' logged in</span>
            </div>
          </div>
        </div>
        
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
          <a href="#" class="text-sm font-medium text-primary-600 dark:text-primary-500 hover:underline">View all logs</a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 